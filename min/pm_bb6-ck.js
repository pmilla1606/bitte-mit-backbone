var TrackModel=Backbone.Model.extend({url:"http://www.bitte.io/go/backbone.php",defaults:{track_uri:0,vote_count:0,track_id:0,party_name:0,playlist_uri:0,current:0,client_votes:0,track_name:"",track_artist:"",vote_direction:0}}),TrackCollection=Backbone.Collection.extend({model:TrackModel,url:"http://www.bitte.io/go/updateSpotify.php",initialize:function(){this.reset()},comparator:function(t){return-t.get("vote_count")}}),AppView=Backbone.View.extend({el:"#tracks",events:{},initialize:function(){var t=this;_.bindAll(t,"render","renderOne"),trackCollection.fetch({success:function(t){trackCollection.add(t)}}),trackCollection.bind("change:vote_count",function(){console.log("trackCollection has changed"),t.render()});var e={delay:2500},o=Backbone.Poller.get(trackCollection,e);o.on("success",function(e){t.render()}),o.start(),$("#loader").fadeOut()},render:function(){var t=this;return t.$el.html(""),trackCollection.each(function(e){1==e.attributes.current?t.renderCurrent(e):t.renderOne(e)}),$(".primary").on("click",function(){$(this).parents("section").toggleClass("active").siblings().toggleClass("inactive"),$(this).siblings(".secondary").toggle().toggleClass("animated flipInX")}),this},renderOne:function(t){var e=new TrackView({model:t});return this.$el.append(e.$el),this},renderCurrent:function(t){t.attributes.party_name!==localStorage.getItem("partyName")?(console.log("resetting localstorage"),localStorage.setItem("partyName",t.attributes.party_name),localStorage.setItem("votesCast",0)):console.log("ids match -- move on");var e=_.template($("#current_track").html());$("#current-track-info").html(e(t.toJSON()));var o=_.template($("#vote_counter").html());$("#voteInfo").html(o({votes_remaining:Math.abs(10-localStorage.getItem("votesCast"))}))}}),TrackView=Backbone.View.extend({tagName:"li",className:"trackListing",template:_.template($("#track_listing").html()),events:{"click .vote-button":"vote"},initialize:function(){this.render()},render:function(){return _.bindAll(this,"vote"),this.$el.html(this.template(this.model.toJSON())),this},voteUpdate:function(){var t=_.template($("#vote_counter").html());console.log(this)},vote:function(t){if(t.preventDefault(),10==localStorage.getItem("votesCast"))return void console.log("out of votes");var e=$(t.target).parents(".trackListing"),o=trackCollection.length,n=this.model.get("vote_count"),a=localStorage.getItem("votesCast");localStorage.setItem("votesCast",Number(a)+1),this.model.set("data-upvote"==t.target.attributes[1].name?{vote_count:Number(n)+1,vote_direction:1}:{vote_count:Number(n)-1,vote_direction:-1}),this.model.save(),$("ul#tracks > li").tsort("span.voteInd",{order:"desc"})}}),trackCollection=new TrackCollection,run=new AppView;$(".primary").on("click",function(){$(this).parents("section").toggleClass("active").siblings().toggleClass("inactive"),$(this).siblings(".secondary").toggle().toggleClass("animated flipInX")});