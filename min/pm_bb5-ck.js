var rowTemplate=$("#track_listing").html(),updateTemplate=$("#vote_updates").html(),data=[{track_id:"11",track_name:"I Am The Lion King",track_artist:"PAPA",track_uri:"spotify:track:68rLqLxfsninXMmL9YOYDQ",party_name:"SSS1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"5",current:"1"},{track_id:"8",track_name:"If You’re My Girl, Then I’m Your Man",track_artist:"PAPA",track_uri:"spotify:track:7L7KEdJEetZZlXdOGjiPZR",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"3",current:"0"},{track_id:"3",track_name:"Young Rut",track_artist:"PAPA",track_uri:"spotify:track:1OO8jZXbcBiy1BHd4btWyH",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"2",current:"0"},{track_id:"7",track_name:"Get Me Through The Night",track_artist:"PAPA",track_uri:"spotify:track:2HwaPOkklM2wLBiFgzxnrV",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"2",current:"0"},{track_id:"12",track_name:"Replacements (Curls In The Grass)",track_artist:"PAPA",track_uri:"spotify:track:0WXvxkxF7DrHbniMWFt3B5",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"1",current:"0"},{track_id:"2",track_name:"Put Me To Work",track_artist:"PAPA",track_uri:"spotify:track:1nTvJgr9WaRk6BDoUdjAmZ",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"0",current:"0"},{track_id:"4",track_name:"Forgotten Days",track_artist:"PAPA",track_uri:"spotify:track:0FkPGV98QtSzlaA7QxKZDM",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"0",current:"0"},{track_id:"5",track_name:"Cotton Candy",track_artist:"PAPA",track_uri:"spotify:track:7KYmNEICvEZkHEeY0RMz13",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"0",current:"0"},{track_id:"6",track_name:"If The Moon Rises",track_artist:"PAPA",track_uri:"spotify:track:3Dfs0kLsKAtnM304KsKPQE",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"0",current:"0"},{track_id:"9",track_name:"Tender Madness",track_artist:"PAPA",track_uri:"spotify:track:7bBnRjOgSI53XhAhT0vym8",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"0",current:"0"},{track_id:"10",track_name:"Got To Move",track_artist:"PAPA",track_uri:"spotify:track:1YpTGlr4XtU0xrlEI60ori",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"0",current:"0"},{track_id:"1",track_name:"PAPA",track_artist:"PAPA",track_uri:"spotify:track:78CKlM2G8bWHzNn9s7QlKj",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"-1",current:"0"}],TrackModel=Backbone.Model.extend({defaults:{track_uri:0,vote_count:0,track_id:0,party_name:0,playlist_uri:0,curent:0,client_votes:0,track_name:"",track_artist:""}}),peopleCollection=new Backbone.Collection(data,{model:TrackModel,comparator:function(t){return-t.get("vote_count")}}),VoteManager=Backbone.View.extend({el:"#header",template:_.template($("#vote_counter").html()),initialize:function(){peopleCollection.on("change",function(){var t=[];for(i=0;i<localStorage.length;i++){var e=localStorage.key(i);"partyName"!==e&&t.push(parseInt(localStorage.getItem(i+1)))}console.log(t)},this),this.render()},render:function(){console.log("vote manager render",peopleCollection.length);var t=peopleCollection.length;this.$el.html(this.template({ls_votes_left:t}))}}),TableView=Backbone.View.extend({el:"#tracks",initialize:function(){var t=this.collection.models[0].attributes.party_name,e=this.collection.models.length;_.bindAll(this,"render","renderOne"),this.model&&(this.model.on("change",this.render,this),console.log(this.model)),peopleCollection.on("change",function(){})},render:function(){return this.collection.sort(),this.collection.each(this.renderOne),this},renderOne:function(t){var e=new RowView({model:t});return this.$el.append(e.render().$el),this}}),RowView=Backbone.View.extend({tagName:"li",className:"trackListing",events:{"click .vote-button":"vote"},initialize:function(){this.model.on("change",this.render,this)},model:peopleCollection.models,render:function(){peopleCollection.sort();var t=_.template(rowTemplate,this.model.toJSON());return this.$el.html(t),this},vote:function(t){t.preventDefault();var e=this.model,r=Number(this.model.get("vote_count"));if(console.log(updateTemplate),"data-upvote"==t.target.attributes[2].name){this.$el.addClass("upvoted");var r=r+1;this.model.set({vote_count:r}),this.$el.removeClass("upvoted")}else{this.$el.addClass("downvoted");var r=r-1;this.model.set({vote_count:r}),this.$el.removeClass("downvoted")}var a=_.template(updateTemplate,this.model.toJSON());$("#track-updater").html(a).fadeIn().delay(1250).fadeOut()}}),UpdateView=Backbone.View.extend({el:"#track-updater",template:_.template($("#vote_updates").html()),initialize:function(){var t=this;t.render()},render:function(){console.log("update trigger",this)}}),tableView=new TableView({collection:peopleCollection});$("body").append(tableView.render().$el);