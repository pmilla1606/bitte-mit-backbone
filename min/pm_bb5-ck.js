var rowTemplate=$("#track_listing").html(),currentTemplate=$("#current_track").html(),updateTemplate=$("#vote_updates").html(),data=[{track_id:"11",track_name:"I Am The Lion King",track_artist:"PAPA",track_uri:"spotify:track:68rLqLxfsninXMmL9YOYDQ",party_name:"SSS1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"5",current:"1"},{track_id:"8",track_name:"If You’re My Girl, Then I’m Your Man",track_artist:"PAPA",track_uri:"spotify:track:7L7KEdJEetZZlXdOGjiPZR",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"3",current:"0"},{track_id:"3",track_name:"Young Rut",track_artist:"PAPA",track_uri:"spotify:track:1OO8jZXbcBiy1BHd4btWyH",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"2",current:"0"},{track_id:"7",track_name:"Get Me Through The Night",track_artist:"PAPA",track_uri:"spotify:track:2HwaPOkklM2wLBiFgzxnrV",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"2",current:"0"},{track_id:"12",track_name:"Replacements (Curls In The Grass)",track_artist:"PAPA",track_uri:"spotify:track:0WXvxkxF7DrHbniMWFt3B5",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"1",current:"0"},{track_id:"2",track_name:"Put Me To Work",track_artist:"PAPA",track_uri:"spotify:track:1nTvJgr9WaRk6BDoUdjAmZ",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"0",current:"0"},{track_id:"4",track_name:"Forgotten Days",track_artist:"PAPA",track_uri:"spotify:track:0FkPGV98QtSzlaA7QxKZDM",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"0",current:"0"},{track_id:"5",track_name:"Cotton Candy",track_artist:"PAPA",track_uri:"spotify:track:7KYmNEICvEZkHEeY0RMz13",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"0",current:"0"},{track_id:"6",track_name:"If The Moon Rises",track_artist:"PAPA",track_uri:"spotify:track:3Dfs0kLsKAtnM304KsKPQE",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"0",current:"0"},{track_id:"9",track_name:"Tender Madness",track_artist:"PAPA",track_uri:"spotify:track:7bBnRjOgSI53XhAhT0vym8",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"0",current:"0"},{track_id:"10",track_name:"Got To Move",track_artist:"PAPA",track_uri:"spotify:track:1YpTGlr4XtU0xrlEI60ori",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"0",current:"0"},{track_id:"1",track_name:"PAPA",track_artist:"PAPA",track_uri:"spotify:track:78CKlM2G8bWHzNn9s7QlKj",party_name:"1395271676171",playlist_uri:"spotify:user:@:playlist:2riMRzFySmWTlEwLyONivf",vote_count:"-1",current:"0"}],TrackModel=Backbone.Model.extend({url:"http://www.bitte.io/go/backbone.php",defaults:{track_uri:0,vote_count:0,track_id:0,party_name:0,playlist_uri:0,curent:0,client_votes:0,track_name:"",track_artist:""}}),PeopleCollection=Backbone.Collection.extend({model:TrackModel,url:"http://www.bitte.io/go/updateSpotify.php",initialize:function(){this.fetch({success:function(t){var e=new TableView({collection:peopleCollection});$("body").append(e.render().$el)}})},comparator:function(t){return-t.get("vote_count")}}),VoteManager=Backbone.View.extend({el:"#header",template:_.template($("#vote_counter").html()),initialize:function(){peopleCollection.on("change",function(){console.log("peopleCollection has changed");var t=[];for(i=0;i<localStorage.length;i++){var e=localStorage.key(i);"partyName"!==e&&t.push(parseInt(localStorage.getItem(i+1)))}console.log(t)},this),this.render()},render:function(){console.log("vote manager render",peopleCollection.length);var t=peopleCollection.length;this.$el.html(this.template({ls_votes_left:t}))}}),TableView=Backbone.View.extend({el:"#tracks",initialize:function(){var t=Backbone.Poller.get(this.collection);t.on("success",function(t){console.log("gay")}),t.start();var e=this.collection.models[0].attributes.party_name,r=this.collection.models.length;_.bindAll(this,"render","renderOne"),this.model&&(this.model.on("change",this.render,this),console.log(this.collection))},render:function(){return console.log(this.collection),this.collection.sort(),this.collection.each(this.renderOne),this},renderOne:function(t){var e=new RowView({model:t});return this.$el.append(e.render().$el),this}}),RowView=Backbone.View.extend({tagName:"li",className:"trackListing",events:{"click .vote-button":"vote"},initialize:function(){this.model.on("change",this.render,this)},render:function(){if(1==this.model.attributes.current){var t=_.template(currentTemplate,this.model.toJSON());this.$el.prepend(t)}else{var e=_.template(rowTemplate,this.model.toJSON());this.$el.html(e)}return this},vote:function(t){t.preventDefault();var e=this.model,r=Number(this.model.get("vote_count"));"data-upvote"==t.target.attributes[2].name?(console.log("up"),this.model.set({vote_count:1})):this.model.set({vote_count:-1}),this.model.save();var i=_.template(updateTemplate,this.model.toJSON());$("#track-updater").html(i).fadeIn().delay(1250).fadeOut(),$("ul#tracks > li").tsort("span.voteInd",{order:"desc"})},sortList:function(){ul=this.$el.parents("ul"),console.log(ul);for(var t=ul[0].getElementsByTagName("LI"),e=[],r=0,i=t.length;i>r;r++)e.push(t[r].innerHTML);e.sort(),e.reverse();for(var r=0,i=t.length;i>r;r++)t[r].innerHTML=e[r]}}),UpdateView=Backbone.View.extend({el:"#track-updater",template:_.template($("#vote_updates").html()),initialize:function(){var t=this;t.render()},render:function(){console.log("update trigger",this)}}),peopleCollection=new PeopleCollection;